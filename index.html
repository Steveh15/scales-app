<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Scale Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">

  <script defer src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
  crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/underscore@1.13.6/underscore-umd-min.js"> </script>
</head>
<body>
  <div class="container mx-auto">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="card">
          <div class="card-header text-center">
            <h3>Piano exercise generator</h3>
          </div>
          <div class="card-body text-center">


            <div  class="jumbotron">
              <h1 id="note"> Ready to go! </h1>
              <span id="key"> </span>
              <span id="exercise"> </span>
              <div id="motion"> </div>
              <div id="articulation"> </div>
              <div id="fingering"> </div>
              <h1 id="counter"> </h1>

            </div>

            <button class="btn btn-primary" onclick="backButton()"><span class="bi bi-arrow-left-circle-fill"></span></button>

            <button class="btn btn-primary" onclick="showNextItem()">Load Scales</button>

            <button class="btn btn-primary" onclick="forwardButton()"><span class="bi bi-arrow-right-circle-fill"></span></button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>

    let app_init = 0;

    let currentItemIndex = 0;

    const keys = [
          // {note: "C", key: "major"},
          // {note: "C", key: "minor"},
      {note: "D♭", key: "major"},
      {note: "C♯", key: "minor"},
      {note: "D", key: "major"},
      {note: "D", key: "minor"},
          // {note: "E♭", key: "major"},
          // {note: "E♭", key: "minor"},
      {note: "E", key: "major"},
      {note: "E", key: "minor"},
      {note: "F", key: "major"},
      {note: "F", key: "minor"},
          // {note: "F♯", key: "major"},
          // {note: "F♯", key: "minor"},
      {note: "G", key: "major"},
      {note: "G", key: "minor"},
      {note: "A♭", key: "major"},
      {note: "G♯", key: "minor"},
          // {note: "A", key: "major"},
          // {note: "A", key: "minor"},
      {note: "B♭", key: "major"},
      {note: "B♭", key: "minor"},
      {note: "B", key: "major"},
      {note: "B", key: "minor"}
      ]


      const arpeggios = [
          // {note: "C", key: "major"},
          // {note: "C", key: "minor"},
      {note: "D♭", key: "major", fingering: "RH - 2, 1 2 4, 1 2 4. LH - 3 2 1, 3 2 1, 2"},
      {note: "C♯", key: "minor", fingering: "RH - 2, 1 2 4, 1 2 4. LH - 3 2 1, 3 2 1, 2"},
      {note: "D", key: "major"},
      {note: "D", key: "minor"},
          // {note: "E♭", key: "major"},
          // {note: "E♭", key: "minor"},
      {note: "E", key: "major"},
      {note: "E", key: "minor"},
      {note: "F", key: "major"},
      {note: "F", key: "minor"},
          // {note: "F♯", key: "major"},
          // {note: "F♯", key: "minor"},
      {note: "G", key: "major"},
      {note: "G", key: "minor"},
      {note: "A♭", key: "major"},
      {note: "G♯", key: "minor"},
          // {note: "A", key: "major"},
          // {note: "A", key: "minor"},
      {note: "B♭", key: "major", fingering: "RH - 2, 1 2 4, 1 2 4. LH - 3 2 1, 3 2 1, 2"},
      {note: "B♭", key: "minor", fingering: "RH - 2, 1 2 3, 1 2 3. LH - 3 2 1, 3 2 1, 2"},
      {note: "B", key: "major"},
      {note: "B", key: "minor"}
      ]

    const major_keys = [
          // {note: "C", key: "major"},
      {note: "D♭", key: "major"},
      {note: "D", key: "major"},
          // {note: "E♭", key: "major"},
      {note: "E", key: "major"},
      {note: "F", key: "major"},
          // {note: "F♯", key: "major"},
      {note: "G", key: "major"},
      {note: "A♭", key: "major"},
          // {note: "A", key: "major"},
      {note: "B♭", key: "major"},
      {note: "B", key: "major"},
      ]


    function showNextItem() {

      if(app_init == 0){
        generateExercises()
        displayExercise()
        app_init = 1
      } else{

        currentItemIndex++;
        if (currentItemIndex >= exercises.length) {
          currentItemIndex = 0;
        }
        displayExercise();
      }



    }
    function displayExercise(){
      document.getElementById("note").innerText = exercises[currentItemIndex].note ;

      if(exercises[currentItemIndex].key != ""){
        document.getElementById("key").innerText = exercises[currentItemIndex].key ;
      }else{
        document.getElementById("key").innerText = "" ;
      }

      document.getElementById("exercise").innerText = exercises[currentItemIndex].exercise ;

      if(exercises[currentItemIndex].articulation != ""){
        document.getElementById("articulation").innerText = exercises[currentItemIndex].articulation ;
      }else{
        document.getElementById("articulation").innerText = "" ;
      }

      if(exercises[currentItemIndex].motion != ""){
        document.getElementById("motion").innerText = exercises[currentItemIndex].motion + " motion";
      }else{
        document.getElementById("motion").innerText = "" ;
      }

      if(exercises[currentItemIndex].fingering){
        document.getElementById("fingering").innerText = exercises[currentItemIndex].fingering;
      }else{
        document.getElementById("fingering").innerText = "" ;
      }

      document.getElementById("counter").innerText = currentItemIndex + 1 + " / " + exercises.length ;
    }

    function generateExercises(){


        // Make scales
      scales = JSON.parse(JSON.stringify(_.sample(keys, 9)));


      for (x of scales) {

        x.exercise = "scale"
        x.articulation = "Legato"
        x.motion = "Similar"

        if(x.key == "minor"){
          if(Math.random() < 0.5){
            x.key  = "harmonic minor"
          }
          else{
            x.key  = "melodic minor"
          }
        }
      }


      // Choose 3 scales to be staccato, choose another 3 to be contrary motion

      rand_n = _.sample([0,1,2,3,4,5,6,7,8], 6);

      scales[rand_n[0]].articulation = "Staccato"
      scales[rand_n[1]].articulation = "Staccato"
      scales[rand_n[2]].articulation = "Staccato"

      scales[rand_n[3]].motion = "Contrary"
      scales[rand_n[4]].motion = "Contrary"
      scales[rand_n[5]].motion = "Contrary"

      if(scales[rand_n[3]].key == "melodic minor") { scales[rand_n[3]].key = "harmonic minor";}
      if(scales[rand_n[4]].key == "melodic minor") { scales[rand_n[4]].key = "harmonic minor";}
      if(scales[rand_n[5]].key == "melodic minor") { scales[rand_n[5]].key = "harmonic minor";}


        // Make Arpeggios

      arpeggios_rand = JSON.parse(JSON.stringify(_.sample(arpeggios, 7)));


      for( x of arpeggios_rand){
        x.exercise = "arpeggio"
        x.articulation = "Legato"
        x.motion = ""
      }


      // Make dom 7 Arpeggios

      arpeggios_dom = JSON.parse(JSON.stringify(_.sample(major_keys, 2)));

      for( x of arpeggios_dom){
        x.exercise = "Dom 7 arpeggio"
        x.articulation = "Legato"
        x.motion = ""
      }

      // Make Chromatic scale


      chrom = JSON.parse(JSON.stringify(_.sample(keys)));
      chrom.key = "";
      chrom.exercise = "chromatic scale"
      chrom.motion = ""


      if(Math.random() < 0.5){
        chrom.articulation  = "Legato"
      }
      else{
        chrom.articulation  = "Staccato"
      }


      exercises = _.shuffle(scales).concat(chrom).concat(_.shuffle(arpeggios_rand)).concat(_.shuffle(arpeggios_dom));

      console.log("The following scales have been generated:")
      console.log(exercises)

      // exercises = _.shuffle(exercises);



    }

    function backButton(){
      if(app_init && currentItemIndex > 0){
        currentItemIndex--;
        displayExercise();
      }

    }

    function forwardButton(){
      if(app_init&& currentItemIndex < exercises.length - 1){
        currentItemIndex++;
        displayExercise();
      }
    }
  </script>
</body>
</html>
